<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Viewer - OSIM MTsN 1 Makassar</title>

  <!-- Tailwind & Lucide -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
    .islamic-pattern {
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2310b981' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    #pdf-canvas { box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 100%; height: auto; }
    .viewer-container { display: flex; justify-content: center; align-items: center; min-height: 500px; }
    .loading-spinner {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #10b981;
      border-radius: 50%;
      width: 50px; height: 50px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }
  </style>
</head>

<body class="bg-gradient-to-br from-green-50 to-blue-50 islamic-pattern">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <img src="Logo OSIM.png" alt="Logo OSIM" class="h-12 w-12 object-contain">
        <div>
          <h1 class="text-xl font-bold text-green-600">OSIM MTsN 1 Makassar</h1>
          <p class="text-xs text-gray-600">PDF Viewer</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <a href="archive.html" class="flex items-center gap-2 text-green-600 hover:text-green-700 transition">
          <i data-lucide="archive" class="w-5 h-5"></i><span class="hidden sm:inline">Arsip</span>
        </a>
        <a href="index.html" class="flex items-center gap-2 text-green-600 hover:text-green-700 transition">
          <i data-lucide="home" class="w-5 h-5"></i><span class="hidden sm:inline">Beranda</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Controls -->
    <div id="controls" class="max-w-4xl mx-auto mb-6 hidden">
      <div class="bg-white rounded-xl shadow-lg p-4 flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-2">
          <button onclick="previousPage()" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
          <span class="text-gray-700 font-medium" id="page-info">Page 1 of 1</span>
          <button onclick="nextPage()" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
        </div>

        <div class="flex items-center gap-2">
          <button onclick="zoomOut()" class="bg-gray-200 text-gray-700 p-2 rounded-lg hover:bg-gray-300"><i data-lucide="zoom-out" class="w-5 h-5"></i></button>
          <span class="text-gray-700 font-medium min-w-[60px] text-center" id="zoom-level">100%</span>
          <button onclick="zoomIn()" class="bg-gray-200 text-gray-700 p-2 rounded-lg hover:bg-gray-300"><i data-lucide="zoom-in" class="w-5 h-5"></i></button>
          <button onclick="resetZoom()" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-300 text-sm font-medium">Reset</button>
        </div>

        <button onclick="downloadPDF()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
          <i data-lucide="download" class="w-5 h-5"></i><span>Download</span>
        </button>
      </div>
    </div>

    <!-- Viewer -->
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6">
      <div class="viewer-container" id="viewer-container">
        <div id="loading" class="text-center">
          <div class="loading-spinner mx-auto mb-4"></div>
          <p class="text-gray-600">Menunggu tautan PDF...</p>
        </div>
        <canvas id="pdf-canvas" class="hidden"></canvas>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white mt-12 py-6 border-t">
    <div class="container mx-auto px-4 text-center text-gray-600">
      <p>&copy; 2025 OSIM MTsN 1 Makassar. All rights reserved.</p>
    </div>
  </footer>

  <script>
    lucide.createIcons();
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    let pdfDoc = null, pageNum = 1, pageRendering = false, pageNumPending = null, scale = 1.5, currentPdfUrl = null;
    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');

    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const fileUrl = params.get('file');
      if (fileUrl) {
        loadPDF(fileUrl);
      } else {
        document.getElementById('loading').innerHTML = `
          <div class="text-center">
            <i data-lucide='alert-circle' class='w-12 h-12 text-yellow-500 mx-auto mb-4'></i>
            <p class='text-gray-700 font-medium'>Tidak ada file PDF dimuat.</p>
            <p class='text-gray-500 text-sm mt-2'>Tambahkan parameter ?file= ke URL untuk memuat PDF.</p>
          </div>`;
        lucide.createIcons();
      }
    });

    function renderPage(num) {
      pageRendering = true;
      pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale });
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        page.render({ canvasContext: ctx, viewport }).promise.then(() => {
          pageRendering = false;
          if (pageNumPending !== null) { renderPage(pageNumPending); pageNumPending = null; }
          document.getElementById('page-info').textContent = `Page ${num} of ${pdfDoc.numPages}`;
          document.getElementById('zoom-level').textContent = `${Math.round(scale * 100 / 1.5)}%`;
        });
      });
      canvas.classList.remove('hidden');
      document.getElementById('loading').classList.add('hidden');
    }

    function queueRenderPage(num) { pageRendering ? pageNumPending = num : renderPage(num); }
    function previousPage() { if (pageNum <= 1) return; pageNum--; queueRenderPage(pageNum); }
    function nextPage() { if (pageNum >= pdfDoc.numPages) return; pageNum++; queueRenderPage(pageNum); }
    function zoomIn() { scale += 0.25; queueRenderPage(pageNum); }
    function zoomOut() { if (scale <= 0.5) return; scale -= 0.25; queueRenderPage(pageNum); }
    function resetZoom() { scale = 1.5; queueRenderPage(pageNum); }

    function loadPDF(url) {
      document.getElementById('loading').innerHTML = '<div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-600">Memuat PDF...</p>';
      currentPdfUrl = url;
      const loadingTask = pdfjsLib.getDocument(url);
      loadingTask.promise.then(pdf => {
        pdfDoc = pdf; pageNum = 1;
        document.getElementById('controls').classList.remove('hidden');
        renderPage(pageNum);
        lucide.createIcons();
      }).catch(err => {
        console.error(err);
        document.getElementById('loading').innerHTML = `
          <div class='text-center'>
            <i data-lucide='alert-circle' class='w-12 h-12 text-red-500 mx-auto mb-4'></i>
            <p class='text-red-600 font-medium'>Gagal memuat PDF</p>
            <p class='text-gray-600 text-sm mt-2'>Pastikan URL file valid.</p>
          </div>`;
        lucide.createIcons();
      });
    }

    function downloadPDF() {
      if (!currentPdfUrl) return alert('Tidak ada PDF yang dimuat.');
      window.open(currentPdfUrl, '_blank');
    }

    document.addEventListener('keydown', e => {
      if (!pdfDoc) return;
      if (e.key === 'ArrowLeft') previousPage();
      if (e.key === 'ArrowRight') nextPage();
      if (e.key === '+' || e.key === '=') zoomIn();
      if (e.key === '-') zoomOut();
    });
  </script>

</body>
</html>
